<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="A statically generated blog example using Next.js and Hashnode."/><title>Simple Steps to Include CDK Diffs in GitHub PRs | Next.js Blog Example with Hashnode</title><link rel="canonical" href="https://engineering.hashnode.com/simple-steps-to-include-cdk-diffs-in-github-prs"/><meta property="og:image" content="https://cdn.hashnode.com/res/hashnode/image/upload/v1686032810745/8f23f4fe-65cd-456d-a263-fa5d74d7c59f.png"/><style>.hljs{display:block;overflow-x:auto;padding:.5em;background:#23241f}.hljs,.hljs-subst,.hljs-tag{color:#f8f8f2}.hljs-emphasis,.hljs-strong{color:#a8a8a2}.hljs-bullet,.hljs-link,.hljs-literal,.hljs-number,.hljs-quote,.hljs-regexp{color:#ae81ff}.hljs-code,.hljs-section,.hljs-selector-class,.hljs-title{color:#a6e22e}.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}.hljs-attr,.hljs-keyword,.hljs-name,.hljs-selector-tag{color:#f92672}.hljs-attribute,.hljs-symbol{color:#66d9ef}.hljs-class .hljs-title,.hljs-params{color:#f8f8f2}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-selector-attr,.hljs-selector-id,.hljs-selector-pseudo,.hljs-string,.hljs-template-variable,.hljs-type,.hljs-variable{color:#e6db74}.hljs-comment,.hljs-deletion,.hljs-meta{color:#75715e}</style><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/d0e5352acbffda1a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d0e5352acbffda1a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-1971b0cfe55b3cec.js" defer=""></script><script src="/_next/static/chunks/main-23c305297f46b9aa.js" defer=""></script><script src="/_next/static/chunks/pages/_app-578b9546cf8037d6.js" defer=""></script><script src="/_next/static/chunks/993-0855efe76f399ee1.js" defer=""></script><script src="/_next/static/chunks/209-1ad34ca62f7e8c97.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-a70486900a6d7b3c.js" defer=""></script><script src="/_next/static/0y8ML8Ut1GKcfVwKpwMCT/_buildManifest.js" defer=""></script><script src="/_next/static/0y8ML8Ut1GKcfVwKpwMCT/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-white dark:bg-neutral-950"><main><div class="container mx-auto undefined"><div class="grid items-center grid-cols-3 gap-10 px-5 py-10 md:grid-cols-2"><div class="col-span-1"><h2 class="text-3xl font-bold md:text-5xl text-slate-950 dark:text-neutral-100"><a href="/">Blog</a></h2></div><div class="flex flex-row justify-end col-span-2 md:col-span-1"><button class="flex flex-row items-center justify-start gap-2 px-4 py-2 text-sm font-semibold transition-colors duration-200 rounded-full border md:text-base md:px-5 md:py-3 hover:bg-primary-600 hover:text-white bg-primary-50 text-primary-600  border-primary-600 dark:bg-primary-500 dark:text-white md:justify-center undefined"><div class="flex flex-row items-center gap-2"><div class="shrink-0"><svg class="w-5 h-5 fill-current" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M13.137 7.1a.75.75 0 1 0 0-1.5v1.5Zm6.765 5.58a.75.75 0 0 0-1.5 0h1.5Zm-17.4-3.13a.75.75 0 1 0-.69 1.332l.69-1.332Zm14.092 2.155a.75.75 0 0 0-.833-1.248l.833 1.248Zm-.312-6.095a.75.75 0 0 0 0 1.5v-1.5ZM22 7.109a.75.75 0 0 0 0-1.5v1.5Zm-3.609 2.108a.75.75 0 1 0 1.5 0h-1.5Zm1.5-5.717a.75.75 0 0 0-1.5 0h1.5ZM8.277 13.377l-.344.666.344-.666Zm1.85.785.118-.74-.117.74Zm3.02-1.058-.417-.624.416.624Zm-1.752.987-.2-.723.2.723Zm7.007 3.695c0 .638-.517 1.155-1.155 1.155v1.5a2.656 2.656 0 0 0 2.655-2.655h-1.5Zm-1.155 1.155H3.906v1.5h13.34v-1.5Zm-13.341 0a1.156 1.156 0 0 1-1.156-1.155h-1.5a2.656 2.656 0 0 0 2.656 2.655v-1.5ZM2.75 17.786v-9.53h-1.5v9.53h1.5Zm0-9.53c0-.638.517-1.155 1.156-1.155V5.6A2.656 2.656 0 0 0 1.25 8.256h1.5Zm1.156-1.155h9.23V5.6h-9.23v1.5Zm15.996 10.685V12.68h-1.5v5.106h1.5ZM1.812 10.88l6.12 3.162.69-1.332-6.12-3.162-.69 1.332Zm11.75 2.847 3.032-2.024-.833-1.248-3.031 2.024.833 1.248Zm2.72-6.62h2.86v-1.5h-2.86v1.5Zm2.86 0H22v-1.5h-2.859v1.5Zm.75 2.11v-2.86h-1.5v2.86h1.5Zm0-2.86V3.5h-1.5v2.859h1.5Zm-11.96 7.685c.87.45 1.453.76 2.078.86l.235-1.482c-.33-.052-.662-.214-1.624-.71l-.688 1.332Zm4.798-1.563c-.9.601-1.213.8-1.535.888l.4 1.446c.61-.168 1.154-.543 1.968-1.086l-.833-1.248Zm-2.72 2.423a3.75 3.75 0 0 0 1.584-.09l-.399-1.445a2.257 2.257 0 0 1-.95.053l-.235 1.482Z"></path></svg></div>Subscibe for updates</div><div class="shrink-0"></div></button></div></div><article class="flex flex-col items-start gap-10 pb-10"><div class="max-w-screen-lg px-5 mx-auto prose md:prose-xl dark:prose-invert prose-h1:text-center"><h1 class="">Simple Steps to Include CDK Diffs in GitHub PRs</h1></div><div class="flex-row items-center justify-center hidden w-full gap-5 md:flex text-slate-700 dark:text-neutral-300"><div class="flex items-center gap-2"><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1663070035311/JaSbIMfve.jpg" class="w-10 h-10 rounded-full" alt="Shad Mirza"/><div class="text-base font-bold text-slate-600 dark:text-neutral-300">Shad Mirza</div></div><time dateTime="2023-06-06T06:27:20.956Z">June 5, 2023</time></div><div class="w-full px-5 sm:mx-0"><div class="sm:mx-0"><div class="relative pt-[56.25%]"><img alt="Cover Image for Simple Steps to Include CDK Diffs in GitHub PRs" loading="lazy" decoding="async" data-nimg="fill" class="border dark:border-neutral-600 rounded-xl w-full" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:cover;color:transparent" sizes="100vw" srcSet="/_next/image?url=https%3A%2F%2Fcdn.hashnode.com%2Fres%2Fhashnode%2Fimage%2Fupload%2Fv1686032625812%2F72664174-525d-44e6-bcc1-94ccd855561f.png&amp;w=640&amp;q=75 640w, /_next/image?url=https%3A%2F%2Fcdn.hashnode.com%2Fres%2Fhashnode%2Fimage%2Fupload%2Fv1686032625812%2F72664174-525d-44e6-bcc1-94ccd855561f.png&amp;w=750&amp;q=75 750w, /_next/image?url=https%3A%2F%2Fcdn.hashnode.com%2Fres%2Fhashnode%2Fimage%2Fupload%2Fv1686032625812%2F72664174-525d-44e6-bcc1-94ccd855561f.png&amp;w=828&amp;q=75 828w, /_next/image?url=https%3A%2F%2Fcdn.hashnode.com%2Fres%2Fhashnode%2Fimage%2Fupload%2Fv1686032625812%2F72664174-525d-44e6-bcc1-94ccd855561f.png&amp;w=1080&amp;q=75 1080w, /_next/image?url=https%3A%2F%2Fcdn.hashnode.com%2Fres%2Fhashnode%2Fimage%2Fupload%2Fv1686032625812%2F72664174-525d-44e6-bcc1-94ccd855561f.png&amp;w=1200&amp;q=75 1200w, /_next/image?url=https%3A%2F%2Fcdn.hashnode.com%2Fres%2Fhashnode%2Fimage%2Fupload%2Fv1686032625812%2F72664174-525d-44e6-bcc1-94ccd855561f.png&amp;w=1920&amp;q=75 1920w, /_next/image?url=https%3A%2F%2Fcdn.hashnode.com%2Fres%2Fhashnode%2Fimage%2Fupload%2Fv1686032625812%2F72664174-525d-44e6-bcc1-94ccd855561f.png&amp;w=2048&amp;q=75 2048w, /_next/image?url=https%3A%2F%2Fcdn.hashnode.com%2Fres%2Fhashnode%2Fimage%2Fupload%2Fv1686032625812%2F72664174-525d-44e6-bcc1-94ccd855561f.png&amp;w=3840&amp;q=75 3840w" src="/_next/image?url=https%3A%2F%2Fcdn.hashnode.com%2Fres%2Fhashnode%2Fimage%2Fupload%2Fv1686032625812%2F72664174-525d-44e6-bcc1-94ccd855561f.png&amp;w=3840&amp;q=75"/></div></div></div><div class="w-full px-5 mx-auto md:max-w-screen-md hashnode-content-style"><p>Hey, everyone! If you've been using AWS, chances are you've come across CDK and building cloud apps with it. As seamless as it is to deploy apps using CDK, it is equally important to monitor changes in infrastructure code and prevent issues.</p>
<p>This guide is here to make your life a bit easier by showing you how to include the CDK diff directly in your GitHub PR.</p>
<p>Let's start by understanding the CDK first.</p>
<h2 id="heading-a-brief-overview-of-cdk-cloud-development-kit">A Brief Overview of CDK (Cloud Development Kit)</h2>
<p>The Cloud Development Kit (CDK) enables developers to define, build, and deploy cloud infrastructure as code using supported programming languages. A CDK app consists of one or more Stacks where each stack defines AWS resources it uses, such as Lambda function, EC2 instance or SNS. This CDK app is usually written in TypeScript, JavaScript, Python, Java, C# or Go.</p>
<p>A stack is simply a collection of AWS resources in the form of constructs managed as a single unit. You instantiate constructs within a stack to declare them to AWS and connect them using well-defined interfaces.</p>
<p>Here's an example of using a construct in AWS CDK to create an Amazon S3 bucket with public read access:</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">import</span> { Stack, StackProps, Construct } <span class="hljs-keyword">from</span> <span class="hljs-string">'@aws-cdk/core'</span>;
<span class="hljs-keyword">import</span> { Bucket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@aws-cdk/aws-s3'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> MyS3BucketStack <span class="hljs-keyword">extends</span> Stack {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params">scope: Construct, id: <span class="hljs-built_in">string</span>, props?: StackProps</span>) {
    <span class="hljs-built_in">super</span>(scope, id, props);

    <span class="hljs-keyword">const</span> bucket = <span class="hljs-keyword">new</span> Bucket(<span class="hljs-built_in">this</span>, <span class="hljs-string">'MyS3Bucket'</span>, {
      publicReadAccess: <span class="hljs-literal">true</span>,
    });
  }
}
</code></pre>
<p>Since a construct is a reusable piece of code that encapsulates AWS resource creation and configuration logic, we can say that these constructs are the building blocks of a CDK app. Please pay close attention to this point, as it will be crucial in understanding why it is important to assess the CDK differences effectively.</p>
<h2 id="heading-importance-of-cdk-diffs-in-github-prs-pull-requests">Importance of CDK Diffs in GitHub PRs (Pull Requests)</h2>
<p>As we just learned, a CDK app enables seamless building and deployment of cloud infrastructure as code. Since we define the resources used in an app as constructs, they can be employed to analyze the differences in resource allocation when changes occur.</p>
<p>These changes can be harmful if overlooked, leading to poor resource allocation, inconsistencies, and fatal crashes.</p>
<p>At times, it may not be apparent that changes could result in the deletion and recreation of a resource. For instance, in the case of a database, this could have disastrous consequences. That's why monitoring whenever there is a change in infrastructure code is essential.</p>
<p>The integration of CDK diffs in GitHub Pull Requests (PRs) makes it much easier for developers to review and analyze changes in the infrastructure code. This helps streamline the development process and ensure efficient cloud infrastructure management.</p>
<p>A CDK diff highlights any modifications, additions, or deletions made to the codebase in a concise format. Since this information is available directly within the pull request, it can be leveraged to understand the proposed changes better, assess their impact, and make informed decisions. This, in turn, helps to minimize the risk of errors and maintain the stability and security of the cloud infrastructure, ultimately leading to a more reliable and robust system.</p>
<p>I hope I've managed to convince you why having the CDK diff available in each pull request is crucial.</p>
<p>Now, let's proceed to learn how to incorporate them.</p>
<h2 id="heading-creating-github-workflow-to-include-cdk-diff-as-a-pr-comment">Creating GitHub Workflow to Include CDK Diff as a PR Comment</h2>
<p>Since we need to add a comment with the CDK difference, we will use GitHub workflow to run a job whenever there is a new pull request. Create a <code>yaml</code> file inside <code>.github/workflows</code> and follow the steps below:</p>
<blockquote>
<p><a class="post-section-overview" href="#heading-heres-the-complete-script">Feel free to click here if you want to skip the explanation.</a></p>
</blockquote>
<h3 id="heading-step-1-add-a-name-for-the-job-and-make-sure-it-runs-on-pull-requests-only">Step 1: Add a name for the job and make sure it runs on pull requests only</h3>
<pre><code class="lang-yaml"><span class="hljs-string">//</span> <span class="hljs-string">.github/workflows/cdk-diff-share.yaml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">CDK</span> <span class="hljs-string">difference</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> [<span class="hljs-string">'main'</span>]
</code></pre>
<h3 id="heading-step-2-define-a-job-and-set-the-environment-permissions-and-machine-it-runs-on">Step 2: Define a Job and Set the Environment, Permissions and Machine it Runs On</h3>
<pre><code class="lang-yaml"><span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">CDK</span> <span class="hljs-string">diff</span>
    <span class="hljs-attr">environment:</span> <span class="hljs-string">prod</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">permissions:</span>
      <span class="hljs-attr">id-token:</span> <span class="hljs-string">write</span>
      <span class="hljs-attr">contents:</span> <span class="hljs-string">write</span>
      <span class="hljs-attr">pull-requests:</span> <span class="hljs-string">write</span>
</code></pre>
<p>Make sure you have <code>contents</code> and <code>pull-requests</code> access so that the job can post the comment.</p>
<h3 id="heading-step-3-define-steps-to-checkout-the-repo-and-install-dependencies">Step 3: Define Steps to Checkout the Repo and Install Dependencies</h3>
<pre><code class="lang-yaml"><span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">repo</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">ref:</span> <span class="hljs-string">${{</span> <span class="hljs-string">github.event.pull_request.head.ref</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">repository:</span> <span class="hljs-string">${{</span> <span class="hljs-string">github.event.pull_request.head.repo.full_name</span> <span class="hljs-string">}}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">pnpm</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">version:</span> <span class="hljs-number">7.27</span><span class="hljs-number">.1</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Node</span> <span class="hljs-string">and</span> <span class="hljs-string">Cache</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">16</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">pnpm</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span> <span class="hljs-string">--prefer-offline</span>
</code></pre>
<p>We are also setting up the cache to speed up the consecutive runs.</p>
<h3 id="heading-step-4-configure-aws-credentials">Step 4: Configure AWS credentials</h3>
<p>We need to be authenticated to access the AWS console; let's set up the AWS credentials using an IAM role.</p>
<pre><code class="lang-yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Configure</span> <span class="hljs-string">AWS</span> <span class="hljs-string">credentials</span>
  <span class="hljs-attr">uses:</span> <span class="hljs-string">aws-actions/configure-aws-credentials@v1-node16</span>
  <span class="hljs-attr">with:</span>
      <span class="hljs-attr">role-to-assume:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.AWS_DEPLOY_ROLE</span> <span class="hljs-string">}}</span>
      <span class="hljs-attr">aws-region:</span> <span class="hljs-string">&lt;region-of-your-choice&gt;</span>
</code></pre>
<p>Note: Always use GitHub secrets to store any credentials.</p>
<h3 id="heading-step-5-run-cdk-sync">Step 5: Run CDK sync</h3>
<p>Run the <code>CDK synth</code> command to generate a CloudFormation stack. We are using <code>aws-cdk</code> to run CDK commands.</p>
<pre><code class="lang-yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CDK</span> <span class="hljs-string">synth</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">cdk</span> <span class="hljs-string">synth</span>
  <span class="hljs-attr">env:</span>
     <span class="hljs-attr">SKIP_SANDBOX:</span> <span class="hljs-literal">true</span>
</code></pre>
<h3 id="heading-step-6-run-cdk-diff">Step 6: Run CDK diff</h3>
<p>Run the <code>CDK diff</code> command to compare the current stack with the deployed stack. Since we need this log in the next step to post a comment, we will also save this in a log file, say <code>output.log</code>.</p>
<p>Once we generate the log file, we can parse it and make it available as <code>GITHUB_OUTPUT</code>.</p>
<pre><code class="lang-yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">AWS</span> <span class="hljs-string">CDK</span> <span class="hljs-string">diff</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">cdk</span> <span class="hljs-string">diff</span> <span class="hljs-string">--app</span> <span class="hljs-string">"./cdk.out/assembly-ProdStage"</span> <span class="hljs-number">2</span><span class="hljs-string">&gt;&amp;1</span> <span class="hljs-number">2</span><span class="hljs-string">&gt;&amp;1</span> <span class="hljs-string">|</span> <span class="hljs-string">tee</span> <span class="hljs-string">output.log</span>
   <span class="hljs-attr">env:</span>
      <span class="hljs-attr">SKIP_SANDBOX:</span> <span class="hljs-literal">true</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Echo</span> <span class="hljs-string">output</span> <span class="hljs-string">log</span>
  <span class="hljs-attr">id:</span> <span class="hljs-string">output_log</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">|
     echo "data&lt;&lt;EOF" &gt;&gt; $GITHUB_OUTPUT
     echo "$(cat output.log)" &gt;&gt; $GITHUB_OUTPUT
     echo "EOF" &gt;&gt; $GITHUB_OUTPUT</span>
</code></pre>
<p>Here, <code>2&gt;&amp;1 2&gt;&amp;1 | tee output.log</code> redirects both stdout and stderr to <code>output.log</code> file and also prints them on the console</p>
<h3 id="heading-step-7-post-the-comment">Step 7: Post the comment</h3>
<p>We are using <code>mshick/add-pr-comment@v2</code> to post a log on the GitHub pull request. We will add a markdown wrapper around the log to make it appear visually appealing.</p>
<pre><code class="lang-yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Post</span> <span class="hljs-string">diff</span> <span class="hljs-string">in</span> <span class="hljs-string">comment</span>
  <span class="hljs-attr">uses:</span> <span class="hljs-string">mshick/add-pr-comment@v2</span>
  <span class="hljs-attr">with:</span>
    <span class="hljs-attr">message-id:</span> <span class="hljs-string">cdk-diff</span>
    <span class="hljs-attr">message:</span> <span class="hljs-string">|
      #### CDK Diff for ProdStage
      &lt;details&gt;
         &lt;summary&gt;Show diff&lt;/summary&gt;
         ` ` `bash
         ${{ steps.output_log.outputs.data }}
         ` ` `
      &lt;/details&gt;</span>
</code></pre>
<p>That's we are done. Here's how the log should appear:</p>
<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1682942481140/7026eab1-1cf9-460c-97e7-6495d65228d2.png" class="image--center mx-auto" /></p>
<h3 id="heading-heres-the-complete-script">Here's the complete script:</h3>
<pre><code class="lang-yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">CDK</span> <span class="hljs-string">difference</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> [<span class="hljs-string">'main'</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">CDK</span> <span class="hljs-string">diff</span>
    <span class="hljs-attr">environment:</span> <span class="hljs-string">prod</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">permissions:</span>
      <span class="hljs-attr">id-token:</span> <span class="hljs-string">write</span>
      <span class="hljs-attr">contents:</span> <span class="hljs-string">write</span>
      <span class="hljs-attr">pull-requests:</span> <span class="hljs-string">write</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">repo</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">ref:</span> <span class="hljs-string">${{</span> <span class="hljs-string">github.event.pull_request.head.ref</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">repository:</span> <span class="hljs-string">${{</span> <span class="hljs-string">github.event.pull_request.head.repo.full_name</span> <span class="hljs-string">}}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">pnpm</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">version:</span> <span class="hljs-number">7.27</span><span class="hljs-number">.1</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Node</span> <span class="hljs-string">and</span> <span class="hljs-string">Cache</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">16</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">pnpm</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span> <span class="hljs-string">--prefer-offline</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Configure</span> <span class="hljs-string">AWS</span> <span class="hljs-string">credentials</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">aws-actions/configure-aws-credentials@v1-node16</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">role-to-assume:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.AWS_DEPLOY_ROLE</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">aws-region:</span> <span class="hljs-string">&lt;your-region-here&gt;</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CDK</span> <span class="hljs-string">synth</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">cdk</span> <span class="hljs-string">synth</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">SKIP_SANDBOX:</span> <span class="hljs-literal">true</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">AWS</span> <span class="hljs-string">CDK</span> <span class="hljs-string">diff</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">cdk</span> <span class="hljs-string">diff</span> <span class="hljs-string">--app</span> <span class="hljs-string">"./cdk.out/assembly-ProdStage"</span> <span class="hljs-number">2</span><span class="hljs-string">&gt;&amp;1</span> <span class="hljs-number">2</span><span class="hljs-string">&gt;&amp;1</span> <span class="hljs-string">|</span> <span class="hljs-string">tee</span> <span class="hljs-string">output.log</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">SKIP_SANDBOX:</span> <span class="hljs-literal">true</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Save</span> <span class="hljs-string">output</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">output_log</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          echo "data&lt;&lt;EOF" &gt;&gt; $GITHUB_OUTPUT
          echo "$(cat output.log)" &gt;&gt; $GITHUB_OUTPUT
          echo "EOF" &gt;&gt; $GITHUB_OUTPUT
</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Post</span> <span class="hljs-string">diff</span> <span class="hljs-string">in</span> <span class="hljs-string">comment</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">mshick/add-pr-comment@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">message-id:</span> <span class="hljs-string">cdk-diff</span>
          <span class="hljs-attr">message:</span> <span class="hljs-string">|
            #### CDK Diff for ProdStage
            &lt;details&gt;
              &lt;summary&gt;Show diff&lt;/summary&gt;
              ` ` `bash
              ${{ steps.output_log.outputs.data }}
              ` ` `
            &lt;/details&gt;</span>
</code></pre>
<blockquote>
<p>Please remove the space between backticks `.</p>
</blockquote>
<h2 id="heading-conclusion"><strong>Conclusion</strong></h2>
<p>CDK diff in GitHub PRs helps us review and analyze changes in infrastructure code, minimizing the risk of errors and maintaining stability and security. CDK diffs highlight modifications, additions, or deletions in the codebase, enabling a better understanding of proposed changes and informed decision-making.</p>
<p>We learned how to utilize <code>cdk diff</code> it to see changes in the intended deployment and post them as a comment on our GitHub PRs.</p>
<p>Do let us know if this article was helpful in the comments.</p>
</div></article></div></main></div><footer class="px-5 py-20 border-t bg-slate-100 dark:bg-neutral-900 dark:border-neutral-800"><div class="container mx-auto grid grid-cols-1 gap-10 md:grid-cols-2"><div class="flex flex-col items-start col-span-1 gap-10 text-slate-500 dark:text-neutral-300"><h3 class="text-lg md:text-xl">The headless blog starter kit by Hashnode. Built with Next.js, TailwindCSS and Hashnode GraphQL APIs.</h3><div class="flex flex-row items-center gap-2 p-5 text-slate-600 bg-slate-200 rounded-xl"><p class="">Blog powered by</p><a href="#" class="flex flex-row items-center gap-1 font-semibold hover:underline"><svg class="w-5 h-5 stroke-current" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-width="1.5" d="M7.314 4.97c1.64-1.64 2.461-2.46 3.407-2.767a4.143 4.143 0 0 1 2.56 0c.946.307 1.766 1.127 3.407 2.768l2.341 2.341c1.64 1.64 2.46 2.46 2.768 3.407.27.832.27 1.728 0 2.56-.307.946-1.127 1.766-2.768 3.407l-2.343 2.343c-1.64 1.64-2.461 2.46-3.407 2.768-.832.27-1.728.27-2.56 0-.946-.307-1.766-1.127-3.407-2.768l-2.341-2.341c-1.64-1.64-2.46-2.46-2.768-3.407a4.143 4.143 0 0 1 0-2.56C2.51 9.775 3.33 8.955 4.97 7.314l2.343-2.343Z"></path><path stroke="currentColor" stroke-width="1.5" d="M15.107 12a3.107 3.107 0 1 1-6.214 0 3.107 3.107 0 0 1 6.214 0Z"></path></svg>Hashnode</a></div></div><div class="flex flex-row items-center justify-start col-span-1 gap-2 md:justify-end text-slate-600 dark:text-neutral-300"><a class="hover:underline" href="#">Privacy</a><a class="hover:underline" href="#">Terms</a><p>Â© Company 2023</p></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"simple-steps-to-include-cdk-diffs-in-github-prs","url":"https://engineering.hashnode.com/simple-steps-to-include-cdk-diffs-in-github-prs","brief":"Hey, everyone! If you've been using AWS, chances are you've come across CDK and building cloud apps with it. As seamless as it is to deploy apps using CDK, it is equally important to monitor changes in infrastructure code and prevent issues.\nThis gui...","title":"Simple Steps to Include CDK Diffs in GitHub PRs","publishedAt":"2023-06-06T06:27:20.956Z","coverImage":{"url":"https://cdn.hashnode.com/res/hashnode/image/upload/v1686032625812/72664174-525d-44e6-bcc1-94ccd855561f.png"},"author":{"name":"Shad Mirza","profilePicture":"https://cdn.hashnode.com/res/hashnode/image/upload/v1663070035311/JaSbIMfve.jpg"},"id":"647ed1c80fce655a6be9ac07","content":{"markdown":"Hey, everyone! If you've been using AWS, chances are you've come across CDK and building cloud apps with it. As seamless as it is to deploy apps using CDK, it is equally important to monitor changes in infrastructure code and prevent issues.\n\nThis guide is here to make your life a bit easier by showing you how to include the CDK diff directly in your GitHub PR.\n\nLet's start by understanding the CDK first.\n\n## A Brief Overview of CDK (Cloud Development Kit)\n\nThe Cloud Development Kit (CDK) enables developers to define, build, and deploy cloud infrastructure as code using supported programming languages. A CDK app consists of one or more Stacks where each stack defines AWS resources it uses, such as Lambda function, EC2 instance or SNS. This CDK app is usually written in TypeScript, JavaScript, Python, Java, C# or Go.\n\nA stack is simply a collection of AWS resources in the form of constructs managed as a single unit. You instantiate constructs within a stack to declare them to AWS and connect them using well-defined interfaces.\n\nHere's an example of using a construct in AWS CDK to create an Amazon S3 bucket with public read access:\n\n```typescript\nimport { Stack, StackProps, Construct } from '@aws-cdk/core';\nimport { Bucket } from '@aws-cdk/aws-s3';\n\nexport class MyS3BucketStack extends Stack {\n  constructor(scope: Construct, id: string, props?: StackProps) {\n    super(scope, id, props);\n\n    const bucket = new Bucket(this, 'MyS3Bucket', {\n      publicReadAccess: true,\n    });\n  }\n}\n```\n\nSince a construct is a reusable piece of code that encapsulates AWS resource creation and configuration logic, we can say that these constructs are the building blocks of a CDK app. Please pay close attention to this point, as it will be crucial in understanding why it is important to assess the CDK differences effectively.\n\n## Importance of CDK Diffs in GitHub PRs (Pull Requests)\n\nAs we just learned, a CDK app enables seamless building and deployment of cloud infrastructure as code. Since we define the resources used in an app as constructs, they can be employed to analyze the differences in resource allocation when changes occur.\n\nThese changes can be harmful if overlooked, leading to poor resource allocation, inconsistencies, and fatal crashes.\n\nAt times, it may not be apparent that changes could result in the deletion and recreation of a resource. For instance, in the case of a database, this could have disastrous consequences. That's why monitoring whenever there is a change in infrastructure code is essential.\n\nThe integration of CDK diffs in GitHub Pull Requests (PRs) makes it much easier for developers to review and analyze changes in the infrastructure code. This helps streamline the development process and ensure efficient cloud infrastructure management.\n\nA CDK diff highlights any modifications, additions, or deletions made to the codebase in a concise format. Since this information is available directly within the pull request, it can be leveraged to understand the proposed changes better, assess their impact, and make informed decisions. This, in turn, helps to minimize the risk of errors and maintain the stability and security of the cloud infrastructure, ultimately leading to a more reliable and robust system.\n\nI hope I've managed to convince you why having the CDK diff available in each pull request is crucial.\n\nNow, let's proceed to learn how to incorporate them.\n\n## Creating GitHub Workflow to Include CDK Diff as a PR Comment\n\nSince we need to add a comment with the CDK difference, we will use GitHub workflow to run a job whenever there is a new pull request. Create a `yaml` file inside `.github/workflows` and follow the steps below:\n\n\u003e [Feel free to click here if you want to skip the explanation.](#heading-heres-the-complete-script)\n\n### Step 1: Add a name for the job and make sure it runs on pull requests only\n\n```yaml\n// .github/workflows/cdk-diff-share.yaml\nname: Run CDK difference\n\non:\n  pull_request:\n    branches: ['main']\n```\n\n### Step 2: Define a Job and Set the Environment, Permissions and Machine it Runs On\n\n```yaml\njobs:\n  build:\n    name: Run CDK diff\n    environment: prod\n    runs-on: ubuntu-latest\n    permissions:\n      id-token: write\n      contents: write\n      pull-requests: write\n```\n\nMake sure you have `contents` and `pull-requests` access so that the job can post the comment.\n\n### Step 3: Define Steps to Checkout the Repo and Install Dependencies\n\n```yaml\nsteps:\n      - name: Checkout repo\n        uses: actions/checkout@v3\n        with:\n          ref: ${{ github.event.pull_request.head.ref }}\n          repository: ${{ github.event.pull_request.head.repo.full_name }}\n      - name: Install pnpm\n        uses: pnpm/action-setup@v2\n        with:\n          version: 7.27.1\n      - name: Setup Node and Cache\n        uses: actions/setup-node@v3\n        with:\n          node-version: 16\n          cache: pnpm\n      - name: Install dependencies\n        run: pnpm install --prefer-offline\n```\n\nWe are also setting up the cache to speed up the consecutive runs.\n\n### Step 4: Configure AWS credentials\n\nWe need to be authenticated to access the AWS console; let's set up the AWS credentials using an IAM role.\n\n```yaml\n- name: Configure AWS credentials\n  uses: aws-actions/configure-aws-credentials@v1-node16\n  with:\n      role-to-assume: ${{ secrets.AWS_DEPLOY_ROLE }}\n      aws-region: \u003cregion-of-your-choice\u003e\n```\n\nNote: Always use GitHub secrets to store any credentials.\n\n### Step 5: Run CDK sync\n\nRun the `CDK synth` command to generate a CloudFormation stack. We are using `aws-cdk` to run CDK commands.\n\n```yaml\n- name: CDK synth\n  run: pnpm cdk synth\n  env:\n     SKIP_SANDBOX: true\n```\n\n### Step 6: Run CDK diff\n\nRun the `CDK diff` command to compare the current stack with the deployed stack. Since we need this log in the next step to post a comment, we will also save this in a log file, say `output.log`.\n\nOnce we generate the log file, we can parse it and make it available as `GITHUB_OUTPUT`.\n\n```yaml\n- name: Run AWS CDK diff\n  run: pnpm cdk diff --app \"./cdk.out/assembly-ProdStage\" 2\u003e\u00261 2\u003e\u00261 | tee output.log\n   env:\n      SKIP_SANDBOX: true\n- name: Echo output log\n  id: output_log\n  run: |\n     echo \"data\u003c\u003cEOF\" \u003e\u003e $GITHUB_OUTPUT\n     echo \"$(cat output.log)\" \u003e\u003e $GITHUB_OUTPUT\n     echo \"EOF\" \u003e\u003e $GITHUB_OUTPUT\n```\n\nHere, `2\u003e\u00261 2\u003e\u00261 | tee output.log` redirects both stdout and stderr to `output.log` file and also prints them on the console\n\n### Step 7: Post the comment\n\nWe are using `mshick/add-pr-comment@v2` to post a log on the GitHub pull request. We will add a markdown wrapper around the log to make it appear visually appealing.\n\n```yaml\n- name: Post diff in comment\n  uses: mshick/add-pr-comment@v2\n  with:\n    message-id: cdk-diff\n    message: |\n      #### CDK Diff for ProdStage\n      \u003cdetails\u003e\n         \u003csummary\u003eShow diff\u003c/summary\u003e\n         ` ` `bash\n         ${{ steps.output_log.outputs.data }}\n         ` ` `\n      \u003c/details\u003e\n```\n\nThat's we are done. Here's how the log should appear:\n\n![](https://cdn.hashnode.com/res/hashnode/image/upload/v1682942481140/7026eab1-1cf9-460c-97e7-6495d65228d2.png align=\"center\")\n\n### Here's the complete script:\n\n```yaml\nname: Run CDK difference\n\non:\n  pull_request:\n    branches: ['main']\n\njobs:\n  build:\n    name: Run CDK diff\n    environment: prod\n    runs-on: ubuntu-latest\n    permissions:\n      id-token: write\n      contents: write\n      pull-requests: write\n    steps:\n      - name: Checkout repo\n        uses: actions/checkout@v3\n        with:\n          ref: ${{ github.event.pull_request.head.ref }}\n          repository: ${{ github.event.pull_request.head.repo.full_name }}\n      - name: Install pnpm\n        uses: pnpm/action-setup@v2\n        with:\n          version: 7.27.1\n      - name: Setup Node and Cache\n        uses: actions/setup-node@v3\n        with:\n          node-version: 16\n          cache: pnpm\n      - name: Install dependencies\n        run: pnpm install --prefer-offline\n      - name: Configure AWS credentials\n        uses: aws-actions/configure-aws-credentials@v1-node16\n        with:\n          role-to-assume: ${{ secrets.AWS_DEPLOY_ROLE }}\n          aws-region: \u003cyour-region-here\u003e\n      - name: CDK synth\n        run: pnpm cdk synth\n        env:\n          SKIP_SANDBOX: true\n      - name: Run AWS CDK diff\n        run: pnpm cdk diff --app \"./cdk.out/assembly-ProdStage\" 2\u003e\u00261 2\u003e\u00261 | tee output.log\n        env:\n          SKIP_SANDBOX: true\n      - name: Save output\n        id: output_log\n        run: |\n          echo \"data\u003c\u003cEOF\" \u003e\u003e $GITHUB_OUTPUT\n          echo \"$(cat output.log)\" \u003e\u003e $GITHUB_OUTPUT\n          echo \"EOF\" \u003e\u003e $GITHUB_OUTPUT\n      - name: Post diff in comment\n        uses: mshick/add-pr-comment@v2\n        with:\n          message-id: cdk-diff\n          message: |\n            #### CDK Diff for ProdStage\n            \u003cdetails\u003e\n              \u003csummary\u003eShow diff\u003c/summary\u003e\n              ` ` `bash\n              ${{ steps.output_log.outputs.data }}\n              ` ` `\n            \u003c/details\u003e\n```\n\n\u003e Please remove the space between backticks \\`.\n\n## **Conclusion**\n\nCDK diff in GitHub PRs helps us review and analyze changes in infrastructure code, minimizing the risk of errors and maintaining stability and security. CDK diffs highlight modifications, additions, or deletions in the codebase, enabling a better understanding of proposed changes and informed decision-making.\n\nWe learned how to utilize `cdk diff` it to see changes in the intended deployment and post them as a comment on our GitHub PRs.\n\nDo let us know if this article was helpful in the comments.","html":"\u003cp\u003eHey, everyone! If you've been using AWS, chances are you've come across CDK and building cloud apps with it. As seamless as it is to deploy apps using CDK, it is equally important to monitor changes in infrastructure code and prevent issues.\u003c/p\u003e\n\u003cp\u003eThis guide is here to make your life a bit easier by showing you how to include the CDK diff directly in your GitHub PR.\u003c/p\u003e\n\u003cp\u003eLet's start by understanding the CDK first.\u003c/p\u003e\n\u003ch2 id=\"heading-a-brief-overview-of-cdk-cloud-development-kit\"\u003eA Brief Overview of CDK (Cloud Development Kit)\u003c/h2\u003e\n\u003cp\u003eThe Cloud Development Kit (CDK) enables developers to define, build, and deploy cloud infrastructure as code using supported programming languages. A CDK app consists of one or more Stacks where each stack defines AWS resources it uses, such as Lambda function, EC2 instance or SNS. This CDK app is usually written in TypeScript, JavaScript, Python, Java, C# or Go.\u003c/p\u003e\n\u003cp\u003eA stack is simply a collection of AWS resources in the form of constructs managed as a single unit. You instantiate constructs within a stack to declare them to AWS and connect them using well-defined interfaces.\u003c/p\u003e\n\u003cp\u003eHere's an example of using a construct in AWS CDK to create an Amazon S3 bucket with public read access:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { Stack, StackProps, Construct } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@aws-cdk/core'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { Bucket } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@aws-cdk/aws-s3'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e MyS3BucketStack \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e Stack {\n  \u003cspan class=\"hljs-keyword\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003escope: Construct, id: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e, props?: StackProps\u003c/span\u003e) {\n    \u003cspan class=\"hljs-built_in\"\u003esuper\u003c/span\u003e(scope, id, props);\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e bucket = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Bucket(\u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'MyS3Bucket'\u003c/span\u003e, {\n      publicReadAccess: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    });\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSince a construct is a reusable piece of code that encapsulates AWS resource creation and configuration logic, we can say that these constructs are the building blocks of a CDK app. Please pay close attention to this point, as it will be crucial in understanding why it is important to assess the CDK differences effectively.\u003c/p\u003e\n\u003ch2 id=\"heading-importance-of-cdk-diffs-in-github-prs-pull-requests\"\u003eImportance of CDK Diffs in GitHub PRs (Pull Requests)\u003c/h2\u003e\n\u003cp\u003eAs we just learned, a CDK app enables seamless building and deployment of cloud infrastructure as code. Since we define the resources used in an app as constructs, they can be employed to analyze the differences in resource allocation when changes occur.\u003c/p\u003e\n\u003cp\u003eThese changes can be harmful if overlooked, leading to poor resource allocation, inconsistencies, and fatal crashes.\u003c/p\u003e\n\u003cp\u003eAt times, it may not be apparent that changes could result in the deletion and recreation of a resource. For instance, in the case of a database, this could have disastrous consequences. That's why monitoring whenever there is a change in infrastructure code is essential.\u003c/p\u003e\n\u003cp\u003eThe integration of CDK diffs in GitHub Pull Requests (PRs) makes it much easier for developers to review and analyze changes in the infrastructure code. This helps streamline the development process and ensure efficient cloud infrastructure management.\u003c/p\u003e\n\u003cp\u003eA CDK diff highlights any modifications, additions, or deletions made to the codebase in a concise format. Since this information is available directly within the pull request, it can be leveraged to understand the proposed changes better, assess their impact, and make informed decisions. This, in turn, helps to minimize the risk of errors and maintain the stability and security of the cloud infrastructure, ultimately leading to a more reliable and robust system.\u003c/p\u003e\n\u003cp\u003eI hope I've managed to convince you why having the CDK diff available in each pull request is crucial.\u003c/p\u003e\n\u003cp\u003eNow, let's proceed to learn how to incorporate them.\u003c/p\u003e\n\u003ch2 id=\"heading-creating-github-workflow-to-include-cdk-diff-as-a-pr-comment\"\u003eCreating GitHub Workflow to Include CDK Diff as a PR Comment\u003c/h2\u003e\n\u003cp\u003eSince we need to add a comment with the CDK difference, we will use GitHub workflow to run a job whenever there is a new pull request. Create a \u003ccode\u003eyaml\u003c/code\u003e file inside \u003ccode\u003e.github/workflows\u003c/code\u003e and follow the steps below:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca class=\"post-section-overview\" href=\"#heading-heres-the-complete-script\"\u003eFeel free to click here if you want to skip the explanation.\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"heading-step-1-add-a-name-for-the-job-and-make-sure-it-runs-on-pull-requests-only\"\u003eStep 1: Add a name for the job and make sure it runs on pull requests only\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e\u003cspan class=\"hljs-string\"\u003e//\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e.github/workflows/cdk-diff-share.yaml\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCDK\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edifference\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003eon:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003epull_request:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebranches:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003e'main'\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"heading-step-2-define-a-job-and-set-the-environment-permissions-and-machine-it-runs-on\"\u003eStep 2: Define a Job and Set the Environment, Permissions and Machine it Runs On\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003ejobs:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCDK\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ediff\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eprod\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu-latest\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003epermissions:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eid-token:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ewrite\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003econtents:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ewrite\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003epull-requests:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ewrite\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMake sure you have \u003ccode\u003econtents\u003c/code\u003e and \u003ccode\u003epull-requests\u003c/code\u003e access so that the job can post the comment.\u003c/p\u003e\n\u003ch3 id=\"heading-step-3-define-steps-to-checkout-the-repo-and-install-dependencies\"\u003eStep 3: Define Steps to Checkout the Repo and Install Dependencies\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003esteps:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCheckout\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erepo\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/checkout@v3\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eref:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egithub.event.pull_request.head.ref\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003erepository:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egithub.event.pull_request.head.repo.full_name\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eInstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm/action-setup@v2\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eversion:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e7.27\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSetup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNode\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eand\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCache\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/setup-node@v3\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003enode-version:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ecache:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eInstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edependencies\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003einstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e--prefer-offline\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe are also setting up the cache to speed up the consecutive runs.\u003c/p\u003e\n\u003ch3 id=\"heading-step-4-configure-aws-credentials\"\u003eStep 4: Configure AWS credentials\u003c/h3\u003e\n\u003cp\u003eWe need to be authenticated to access the AWS console; let's set up the AWS credentials using an IAM role.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eConfigure\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eAWS\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecredentials\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eaws-actions/configure-aws-credentials@v1-node16\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003erole-to-assume:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.AWS_DEPLOY_ROLE\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eaws-region:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026lt;region-of-your-choice\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNote: Always use GitHub secrets to store any credentials.\u003c/p\u003e\n\u003ch3 id=\"heading-step-5-run-cdk-sync\"\u003eStep 5: Run CDK sync\u003c/h3\u003e\n\u003cp\u003eRun the \u003ccode\u003eCDK synth\u003c/code\u003e command to generate a CloudFormation stack. We are using \u003ccode\u003eaws-cdk\u003c/code\u003e to run CDK commands.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCDK\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esynth\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecdk\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esynth\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eenv:\u003c/span\u003e\n     \u003cspan class=\"hljs-attr\"\u003eSKIP_SANDBOX:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"heading-step-6-run-cdk-diff\"\u003eStep 6: Run CDK diff\u003c/h3\u003e\n\u003cp\u003eRun the \u003ccode\u003eCDK diff\u003c/code\u003e command to compare the current stack with the deployed stack. Since we need this log in the next step to post a comment, we will also save this in a log file, say \u003ccode\u003eoutput.log\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eOnce we generate the log file, we can parse it and make it available as \u003ccode\u003eGITHUB_OUTPUT\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eAWS\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCDK\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ediff\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecdk\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ediff\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e--app\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"./cdk.out/assembly-ProdStage\"\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026gt;\u0026amp;1\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026gt;\u0026amp;1\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etee\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eoutput.log\u003c/span\u003e\n   \u003cspan class=\"hljs-attr\"\u003eenv:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eSKIP_SANDBOX:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eEcho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eoutput\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003elog\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eid:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eoutput_log\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\n     echo \"data\u0026lt;\u0026lt;EOF\" \u0026gt;\u0026gt; $GITHUB_OUTPUT\n     echo \"$(cat output.log)\" \u0026gt;\u0026gt; $GITHUB_OUTPUT\n     echo \"EOF\" \u0026gt;\u0026gt; $GITHUB_OUTPUT\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere, \u003ccode\u003e2\u0026gt;\u0026amp;1 2\u0026gt;\u0026amp;1 | tee output.log\u003c/code\u003e redirects both stdout and stderr to \u003ccode\u003eoutput.log\u003c/code\u003e file and also prints them on the console\u003c/p\u003e\n\u003ch3 id=\"heading-step-7-post-the-comment\"\u003eStep 7: Post the comment\u003c/h3\u003e\n\u003cp\u003eWe are using \u003ccode\u003emshick/add-pr-comment@v2\u003c/code\u003e to post a log on the GitHub pull request. We will add a markdown wrapper around the log to make it appear visually appealing.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePost\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ediff\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecomment\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emshick/add-pr-comment@v2\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003emessage-id:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecdk-diff\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003emessage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\n      #### CDK Diff for ProdStage\n      \u0026lt;details\u0026gt;\n         \u0026lt;summary\u0026gt;Show diff\u0026lt;/summary\u0026gt;\n         ` ` `bash\n         ${{ steps.output_log.outputs.data }}\n         ` ` `\n      \u0026lt;/details\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThat's we are done. Here's how the log should appear:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn.hashnode.com/res/hashnode/image/upload/v1682942481140/7026eab1-1cf9-460c-97e7-6495d65228d2.png\" alt class=\"image--center mx-auto\" /\u003e\u003c/p\u003e\n\u003ch3 id=\"heading-heres-the-complete-script\"\u003eHere's the complete script:\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCDK\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edifference\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003eon:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003epull_request:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebranches:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003e'main'\u003c/span\u003e]\n\n\u003cspan class=\"hljs-attr\"\u003ejobs:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCDK\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ediff\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eprod\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu-latest\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003epermissions:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eid-token:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ewrite\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003econtents:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ewrite\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003epull-requests:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ewrite\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003esteps:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCheckout\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erepo\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/checkout@v3\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eref:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egithub.event.pull_request.head.ref\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003erepository:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egithub.event.pull_request.head.repo.full_name\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eInstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm/action-setup@v2\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eversion:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e7.27\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSetup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNode\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eand\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCache\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/setup-node@v3\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003enode-version:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ecache:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eInstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edependencies\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003einstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e--prefer-offline\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eConfigure\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eAWS\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecredentials\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eaws-actions/configure-aws-credentials@v1-node16\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003erole-to-assume:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.AWS_DEPLOY_ROLE\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eaws-region:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026lt;your-region-here\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCDK\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esynth\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecdk\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esynth\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eenv:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eSKIP_SANDBOX:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eAWS\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCDK\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ediff\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epnpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecdk\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ediff\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e--app\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"./cdk.out/assembly-ProdStage\"\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026gt;\u0026amp;1\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026gt;\u0026amp;1\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etee\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eoutput.log\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eenv:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eSKIP_SANDBOX:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSave\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eoutput\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eid:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eoutput_log\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\n          echo \"data\u0026lt;\u0026lt;EOF\" \u0026gt;\u0026gt; $GITHUB_OUTPUT\n          echo \"$(cat output.log)\" \u0026gt;\u0026gt; $GITHUB_OUTPUT\n          echo \"EOF\" \u0026gt;\u0026gt; $GITHUB_OUTPUT\n\u003c/span\u003e      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePost\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ediff\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecomment\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emshick/add-pr-comment@v2\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003emessage-id:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecdk-diff\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003emessage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\n            #### CDK Diff for ProdStage\n            \u0026lt;details\u0026gt;\n              \u0026lt;summary\u0026gt;Show diff\u0026lt;/summary\u0026gt;\n              ` ` `bash\n              ${{ steps.output_log.outputs.data }}\n              ` ` `\n            \u0026lt;/details\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003ePlease remove the space between backticks `.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"heading-conclusion\"\u003e\u003cstrong\u003eConclusion\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003eCDK diff in GitHub PRs helps us review and analyze changes in infrastructure code, minimizing the risk of errors and maintaining stability and security. CDK diffs highlight modifications, additions, or deletions in the codebase, enabling a better understanding of proposed changes and informed decision-making.\u003c/p\u003e\n\u003cp\u003eWe learned how to utilize \u003ccode\u003ecdk diff\u003c/code\u003e it to see changes in the intended deployment and post them as a comment on our GitHub PRs.\u003c/p\u003e\n\u003cp\u003eDo let us know if this article was helpful in the comments.\u003c/p\u003e\n"},"ogMetaData":{"image":"https://cdn.hashnode.com/res/hashnode/image/upload/v1686032810745/8f23f4fe-65cd-456d-a263-fa5d74d7c59f.png"}}},"__N_SSG":true},"page":"/[slug]","query":{"slug":"simple-steps-to-include-cdk-diffs-in-github-prs"},"buildId":"0y8ML8Ut1GKcfVwKpwMCT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>